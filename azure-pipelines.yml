trigger:
- Azure 
#- master

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

jobs:
  - job: 'Build'
    steps: 
      - task: NuGetToolInstaller@1
        inputs:
          checkLatest: true
      - task: NuGetCommand@2
        inputs:
          command: 'restore'
          restoreSolution: '**/*.sln'
          feedsToUse: 'select'
      - task: VSBuild@1
        inputs:
          solution: '**\*.sln'
          msbuildArgs: '/p:AllowUnsafeBlocks=true'
          platform: 'Any CPU'
          configuration: 'Release'
          clean: true
          createLogFile: true

  # Run Some Tests
  - job: 'Test'
    steps:
    - task: DownloadSecureFile@1
      inputs:
        secureFile: 'SMW_U.sfc'
        retryCount: 5
    - task: CopyFiles@2
      inputs:
        SourceFolder: '$(Agent.TempDirectory)'
        Contents: 'SMW_U.sfc'
        TargetFolder: 'src\Back\bin\Release'
        OverWrite: true
    # Run Backend Tests on clean unheadered ROM
    - task: CmdLine@2
      inputs:
        script: 'Back.exe SMW_u.sfc'
        workingDirectory: 'src\Back\bin\Release'
        failOnStderr: true