version: 2.1

jobs:
  linuxBuild:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - run:
          name: "Perform Git Checkout"
          command: |
            git checkout dev
            git submodule sync
            git submodule update --init

      - run:
          name: "Install .NET SDK"
          command: |
            wget https://dot.net/v1/dotnet-install.sh
            chmod +x ./dotnet-install.sh
            ./dotnet-install.sh -c 6.0

      - run:
          name: "Build Native Dependencies with CMake"
          command: |
            mkdir ./binCache
            cd ./submodules/asar
            cmake -S ./src -B ./cmakeCache
            cd ./cmakeCache
            make
            cp ./asar/libasar.so ../../../binCache
            cd ../../../

      - run:
          name: "Build .NET Projects"
          command: |
            cd ./src/RetroMole.Launch
            ~/.dotnet/dotnet build
            cp ../../binCache/* ./bin/Debug/net6.0

workflows:
  version: 2
  linux:
    jobs:
      - linuxBuild
