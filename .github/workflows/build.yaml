name: Build
on: [push, pull_request, workflow_dispatch]

jobs:        
  LinuxBuild:
    if: 
      ${{ 
        !(
          contains(github.event.head_commit.message, '[windows-only]') ||
          contains(github.event.head_commit.message, '[macos-only]') ||
          contains(github.event.head_commit.message, '[linux-skip]') ||
          contains(github.event.head_commit.message, '[ci-skip]')
        )
        }}
    runs-on: ubuntu-latest
    steps: 
      # Download repo
      - name: Pull repo
        uses: actions/checkout@v2
        with:
          submodules: 'recursive'
        
      # Setup dotnet
      - name: Setup dotnet
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: '5.0.401'    
      
      # Build solution
      - name: Build solution
        run: dotnet build ./src/Mole.sln -o ./bin
      
      # Upload build artifacts to github
      - name: Upload build artifacts
        uses: actions/upload-artifact@v2.3.0
        with:
          name: Linux
          path: ./bin
          
  WindowsBuild:
    if: 
      ${{ 
        !(
          contains(github.event.head_commit.message, '[linux-only]') ||
          contains(github.event.head_commit.message, '[macos-only]') ||
          contains(github.event.head_commit.message, '[windows-skip]') ||
          contains(github.event.head_commit.message, '[ci-skip]')
        )
        }}
    runs-on: windows-latest
    steps: 
      # Download repo
      - name: Pull repo
        uses: actions/checkout@v2
        with:
          submodules: 'recursive'
        
      # Setup dotnet
      - name: Setup dotnet
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: '5.0.401'    
      
      # Build solution
      - name: Build solution
        run: dotnet build ./src/Mole.sln -o ./bin
      
      # Upload build artifacts to github
      - name: Upload build artifacts
        uses: actions/upload-artifact@v2.3.0
        with:
          name: Windows
          path: ./bin
          
  MacOSBuild:
    if: 
      ${{ 
        !(
          contains(github.event.head_commit.message, '[windows-only]') ||
          contains(github.event.head_commit.message, '[linux-only]') ||
          contains(github.event.head_commit.message, '[macos-skip]') ||
          contains(github.event.head_commit.message, '[ci-skip]')
        )
        }}
    runs-on: macos-latest
    steps: 
      # Download repo
      - name: Pull repo
        uses: actions/checkout@v2
        with:
          submodules: 'recursive'
        
      # Setup dotnet
      - name: Setup dotnet
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: '5.0.401'    
      
      # Build solution
      - name: Build solution
        run: dotnet build ./src/Mole.sln -o ./bin
      
      # Upload build artifacts to github
      - name: Upload build artifacts
        uses: actions/upload-artifact@v2.3.0
        with:
          name: MacOS
          path: ./bin
